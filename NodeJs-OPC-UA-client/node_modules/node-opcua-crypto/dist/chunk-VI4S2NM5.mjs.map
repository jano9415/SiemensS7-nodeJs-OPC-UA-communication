{"version":3,"sources":["../source/explore_asn1.ts"],"sourcesContent":["import { BlockInfo, readTag, _readStruct, TagType } from \"./asn1\";\nimport { hexDump } from \"./crypto_utils\";\n\nfunction t(tag: number) {\n    // convert Asn1 tag to string\n    return TagType[tag];\n}\nfunction bi(blockInfo: BlockInfo, depth: number) {\n    const indent = \"  \".repeat(depth);\n    const hl = blockInfo.position - blockInfo.start; // header length\n    return `${blockInfo.start.toString().padStart(5, \" \")}:d=${depth} hl=${hl.toString().padEnd(3, \" \")}  l=${blockInfo.length\n        .toString()\n        .padStart(6, \" \")} ${blockInfo.tag.toString(16).padEnd(2, \" \")} ${indent} ${t(blockInfo.tag)}`;\n}\n\nexport function exploreAsn1(buffer: Buffer) {\n    console.log(hexDump(buffer));\n\n    function dump(offset: number, depth: number) {\n        const blockInfo = readTag(buffer, offset);\n        dumpBlock(blockInfo, depth);\n\n        function dumpBlock(blockInfo: BlockInfo, depth: number) {\n            console.log(bi(blockInfo, depth));\n            if (blockInfo.tag === TagType.SEQUENCE || blockInfo.tag === TagType.SET || blockInfo.tag >= TagType.CONTEXT_SPECIFIC0) {\n                const blocks = _readStruct(buffer, blockInfo);\n                for (const block of blocks) {\n                    dumpBlock(block, depth +1);\n                }\n            }\n        }\n    }\n    dump(0, 0);\n}\n"],"mappings":";;;;;;;;AAGA,SAAS,EAAE,KAAa;AAEpB,SAAO,QAAQ,GAAG;AACtB;AACA,SAAS,GAAG,WAAsB,OAAe;AAC7C,QAAM,SAAS,KAAK,OAAO,KAAK;AAChC,QAAM,KAAK,UAAU,WAAW,UAAU;AAC1C,SAAO,GAAG,UAAU,MAAM,SAAS,EAAE,SAAS,GAAG,GAAG,CAAC,MAAM,KAAK,OAAO,GAAG,SAAS,EAAE,OAAO,GAAG,GAAG,CAAC,OAAO,UAAU,OAC/G,SAAS,EACT,SAAS,GAAG,GAAG,CAAC,IAAI,UAAU,IAAI,SAAS,EAAE,EAAE,OAAO,GAAG,GAAG,CAAC,IAAI,MAAM,IAAI,EAAE,UAAU,GAAG,CAAC;AACpG;AAEO,SAAS,YAAY,QAAgB;AACxC,UAAQ,IAAI,QAAQ,MAAM,CAAC;AAE3B,WAAS,KAAK,QAAgB,OAAe;AACzC,UAAM,YAAY,QAAQ,QAAQ,MAAM;AACxC,cAAU,WAAW,KAAK;AAE1B,aAAS,UAAUA,YAAsBC,QAAe;AACpD,cAAQ,IAAI,GAAGD,YAAWC,MAAK,CAAC;AAChC,UAAID,WAAU,6BAA4BA,WAAU,wBAAuBA,WAAU,oCAAkC;AACnH,cAAM,SAAS,YAAY,QAAQA,UAAS;AAC5C,mBAAW,SAAS,QAAQ;AACxB,oBAAU,OAAOC,SAAO,CAAC;AAAA,QAC7B;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AACA,OAAK,GAAG,CAAC;AACb;","names":["blockInfo","depth"]}